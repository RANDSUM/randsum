$schema: 'https://moonrepo.dev/schemas/tasks.json'

tasks:
  build:
    command: 'npx bunup'
    inputs:
      - 'src/**/*'
      - 'bunup.config.ts'
      - '../../bunup.config.base.ts'
    outputs:
      - 'dist/**/*'
    options:
      cache: true

  test:
    command: 'bun test'
    deps:
      - 'build'
    inputs:
      - 'src/**/*'
      - '__tests__/**/*'
      - '**/*.test.ts'
      - '**/*.spec.ts'
      - 'bunfig.toml'
    options:
      cache: true

  lint:
    command: 'eslint . -c ../../eslint.base.config.js'
    deps:
      - 'build'
    inputs:
      - 'src/**/*'
      - '__tests__/**/*'
      - '**/*.ts'
    options:
      cache: true

  lint:fix:
    command: 'eslint . -c ../../eslint.base.config.js --fix'
    deps:
      - 'build'
    inputs:
      - 'src/**/*'
      - '__tests__/**/*'
      - '**/*.ts'

  format:
    command: 'prettier . --check'
    deps:
      - 'build'
    inputs:
      - 'src/**/*'
      - '__tests__/**/*'
      - '**/*.ts'
      - '**/*.json'
      - '**/*.md'
    options:
      cache: true

  format:fix:
    command: 'prettier . --write'
    deps:
      - 'build'
    inputs:
      - 'src/**/*'
      - '__tests__/**/*'
      - '**/*.ts'
      - '**/*.json'
      - '**/*.md'

  tsCheck:
    command: 'tsc --erasableSyntaxOnly'
    deps:
      - 'build'
    inputs:
      - 'src/**/*'
      - 'tsconfig.json'
    options:
      cache: true

  publish:
    command: 'bun publish --no-git-checks'
    options:
      runInCI: false
    deps:
      - 'build'
      - 'test'
      - 'lint'
      - 'format'
      - 'tsCheck'

  ci:
    deps:
      - 'build'
      - 'test'
      - 'lint'
      - 'format'
      - 'tsCheck'
